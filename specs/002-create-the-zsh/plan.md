# Implementation Plan: Core Zsh Framework Modules

**Branch**: `002-create-the-zsh` | **Date**: 2025-10-11 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/002-create-the-zsh/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command.

## Summary

This feature implements the core Zsh framework modules that provide intelligent completion system initialization, enhanced keybindings, sensible shell options and environment configuration, directory management features, basic prompt support, and cross-platform utility functions. These modules work hand-in-hand with the plugin engine from feature 001 to create a complete, zero-configuration Zsh framework. The modules are loaded in a specific order (environment → compinit → completions → keybinds → directory → prompt → utilities) and each can be independently disabled or customized by users.

## Technical Context

**Language/Version**: Zsh (compatible with Zsh 5.0+)
**Primary Dependencies**: Zsh builtins (compinit, bindkey, setopt, zstyle), POSIX utilities (ls, less)
**Storage**: Cache files (zcompdump in $PULSE_CACHE_DIR), HISTFILE for shell history
**Testing**: bats-core (existing test framework from feature 001)
**Target Platform**: Unix-like systems (Linux, macOS, BSD)
**Project Type**: Single project (Zsh plugin orchestrator with framework modules)
**Performance Goals**: Each framework module <30ms startup overhead, total framework <50ms
**Constraints**: Zero configuration by default, no external dependencies beyond Zsh builtins, preserve user customizations
**Scale/Scope**: Single-user shell environment with 6 framework modules (compinit, completions, keybinds, environment, directory, prompt, utilities)
**Module Load Order**: environment → compinit → completions → keybinds → directory → prompt → utilities
**Integration**: Must work seamlessly with plugin-engine.zsh from feature 001

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Radical Simplicity (Principle I)

- [x] Feature serves 90% of users (not edge case functionality)
  - **YES**: Completions, keybindings, and shell options are core shell features used by all users daily
- [x] No simpler alternative exists to achieve the same goal
  - **YES**: These are fundamental Zsh features that must be configured. No simpler approach than sensible defaults
- [x] Feature justification documented (why it's essential)
  - **YES**: Spec clearly shows these modules transform raw Zsh into a usable, productive shell environment
- [x] Deletion considered before addition
  - **YES**: Each module provides core functionality. P3 modules (prompt, utilities) are optional/minimal

### Quality Over Features (Principle II)

- [x] Code style follows Zsh conventions
  - **STRATEGY**: Use Zsh best practices (autoload, zstyle, setopt), follow naming conventions (pulse_* prefix)
- [x] Error handling strategy defined
  - **STRATEGY**: Each module loads independently; one failure doesn't break others. Graceful degradation with warnings
- [x] Documentation approach specified
  - **STRATEGY**: Inline comments in each module, user-facing docs in README, technical docs in quickstart.md
- [x] Performance impact assessed
  - **STRATEGY**: Each module <30ms, total <50ms. Profile with `time` builtin. Lazy load where possible

### Test-Driven Reliability (Principle III) - NON-NEGOTIABLE

- [x] Test strategy defined (unit, integration, real-world scenarios)
  - **STRATEGY**: Unit tests per module (test each function), integration tests (full shell startup), compatibility tests (Zsh 5.0-5.9, Linux/macOS/BSD)
- [x] Test environment requirements documented
  - **STRATEGY**: Use bats-core with fixtures for different Zsh versions and terminal configurations
- [x] Coverage targets specified
  - **TARGET**: 100% of public functions tested, all user stories have integration tests, edge cases covered
- [x] Tests will be written BEFORE implementation
  - **COMMITMENT**: Tests written first for each module, following TDD approach per constitution

### Consistent User Experience (Principle IV)

- [x] Default behavior documented and sensible
  - **YES**: All defaults documented in spec (completion menu, emacs mode, history deduplication, auto_cd, etc.)
- [x] No breaking changes OR major version bump justified
  - **YES**: New feature, no breaking changes. Adds to existing plugin engine without modifying it
- [x] User feedback approach specified
  - **STRATEGY**: Clear error messages, optional debug mode (PULSE_DEBUG), documentation of all defaults
- [x] Backward compatibility addressed
  - **YES**: Users can override any default by setting options/bindings after Pulse loads. Never override user settings

### Zero Configuration (Principle V)

- [x] Works without configuration OR configuration unavoidable (justify)
  - **YES**: Works immediately with sensible defaults. No configuration required
- [x] Smart defaults defined
  - **YES**: All defaults specified in spec (menu completion, history settings, colors, EDITOR/PAGER detection, etc.)
- [x] Auto-detection strategy specified
  - **YES**: Detect editing mode (vi/emacs), terminal capabilities (colors), available editors/pagers, OS type
- [x] Configuration options minimized
  - **YES**: Zero required configuration. Optional: disable modules, override stage, set debug mode

## Project Structure

### Documentation (this feature)

```
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
pulse/
├── pulse.zsh           # Main entry point
├── lib/                # Core modules (modular, lazy-loadable)
│   ├── compinit.zsh
│   ├── completions.zsh
│   ├── keybinds.zsh
│   ├── plugin-engine.zsh
│   └── [feature].zsh   # New feature modules here
├── tests/              # Test suite
│   ├── integration/    # End-to-end workflow tests
│   ├── unit/           # Individual function tests
│   └── fixtures/       # Test data and mock environments
└── docs/               # User and developer documentation
```

**Structure Decision**: Pulse uses a single-project structure with modular
lib/*.zsh files. Each module is independently loadable and testable. New
features extend existing modules or add new modules following the pulse_*
naming convention.

## Complexity Tracking

No constitution violations. All checks passed.
